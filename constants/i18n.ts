
import { I18n } from 'i18n-js';
import * as Localization from 'expo-localization';
import AsyncStorage from '@react-native-async-storage/async-storage';

// Define translations
const translations = {
  en: {
    // ... (keeping all existing translations, only updating the withdrawal-related ones)
    
    // Withdrawals (Retiros) Page - UPDATED TO TRC20
    withdraw: 'Withdraw',
    retiros: 'Withdrawals',
    loadingData: 'Loading data...',
    mxiAvailable: 'MXI Available',
    totalMXI: 'Total MXI',
    approximateUSDT: 'Approximate USDT',
    withdrawalType: 'Withdrawal Type',
    withdrawMXIPurchased: 'Withdraw Purchased MXI',
    mxiAcquiredThroughPurchases: 'MXI acquired through purchases',
    lockedUntilLaunch: 'Locked until launch',
    withdrawMXICommissions: 'Withdraw Commission MXI',
    mxiFromReferralCommissions: 'MXI from referral commissions',
    available: 'Available',
    availableLabel: 'Available',
    withdrawMXIVesting: 'Withdraw Vesting MXI',
    mxiGeneratedByYield: 'MXI generated by yield',
    realTime: 'Real-time',
    activeReferralsForVestingWithdrawals: '7 Active Referrals for vesting withdrawals ({{count}}/7)',
    withdrawMXITournaments: 'Withdraw Tournament MXI',
    mxiWonInTournamentsAndChallenges: 'MXI won in tournaments and challenges',
    withdrawalDetails: 'Withdrawal Details',
    withdrawalsInUSDT: 'Withdrawals are processed in USDT',
    withdrawalsInUSDTTRC20: 'Withdrawals in USDT (TRC20 Network - Tron)',
    amountMXI: 'Amount (MXI)',
    amountInMXI: 'Amount in MXI',
    maximum: 'Max',
    equivalentInUSDT: 'Equivalent in USDT',
    rate: 'Rate',
    walletAddressTRC20: 'Wallet Address (TRC20)',
    enterYourTRC20WalletAddress: 'Enter your TRC20 wallet address (Tron)',
    requestWithdrawal: 'Request Withdrawal',
    withdrawalRequirements: 'Withdrawal Requirements',
    activeReferralsForGeneralWithdrawals2: '5 Active Referrals for general withdrawals ({{count}}/5)',
    mxiLaunchRequiredForPurchasedAndVesting: 'MXI Launch required for Purchased and Vesting withdrawals',
    importantInformation: 'Important Information',
    withdrawalsInUSDTTRC20Info: 'Withdrawals are processed in USDT on the TRC20 network (Tron)',
    conversionInfo: 'Conversion rate: 1 MXI = 0.4 USDT',
    mxiCommissionsInfo: 'Commission MXI is available immediately with 5 active referrals + KYC',
    mxiTournamentsInfo: 'Tournament MXI is available with the same requirements as commissions',
    mxiVestingInfo: 'Vesting MXI requires 7 active referrals and MXI launch',
    mxiPurchasedInfo: 'Purchased MXI is locked until the official MXI launch',
    mxiCommissionsAvailableImmediately: 'Commission MXI is available immediately with 5 active referrals + KYC',
    mxiTournamentsAvailableSameAsCommissions: 'Tournament MXI is available with the same requirements as commissions',
    mxiVestingRequires7Referrals: 'Vesting MXI requires 7 active referrals and MXI launch',
    mxiPurchasedLockedUntilLaunch: 'Purchased MXI is locked until the official MXI launch',
    realTimeUpdateInfo: 'Vesting balance updates in real-time every second',
    processingTime: 'Processing Time',
    processingTimeInfo: 'Withdrawals are processed within 24-48 hours',
    verifyWalletAddress: 'Verify Wallet Address',
    verifyWalletAddressInfo: 'Verify your wallet address carefully before submitting',
    viewWithdrawalHistory2: 'View Withdrawal History',
    invalidAmount: 'Invalid Amount',
    enterValidAmount: 'Please enter a valid amount',
    missingInformation: 'Missing Information',
    enterWalletAddress: 'Please enter your wallet address',
    insufficientBalanceNeed: 'You need {{needed}} MXI but only have {{available}} MXI available',
    withdrawalNotAvailable: 'Withdrawal Not Available',
    withdrawalsAvailableAfterLaunch: '{{label}} withdrawals will be available after MXI launch ({{days}} days remaining)',
    requirementNotMet: 'Requirement Not Met',
    vestingRequires7Referrals: 'Vesting withdrawals require 7 active referrals. You currently have {{count}}.',
    understood: 'Understood',
    notEligible: 'Not Eligible',
    need5ActiveReferralsAndKYC: 'You need 5 active referrals and approved KYC to withdraw commissions and tournaments',
    confirmWithdrawal: 'Confirm Withdrawal',
    confirmWithdrawalMessage: 'Are you sure you want to withdraw {{mxi}} MXI ({{label}})?\n\nYou will receive approximately {{usdt}} USDT',
    requestSent: 'Request Sent',
    withdrawalRequestSent: 'Withdrawal request sent successfully!\n\n{{mxi}} MXI ({{label}}) → {{usdt}} USDT\n\nAn administrator will process your withdrawal within 24-48 hours.',
    errorProcessingWithdrawal: 'Error processing withdrawal. Please try again.',
    mxiPurchasedText: 'Purchased MXI',
    mxiCommissionsText: 'Commission MXI',
    mxiVestingText: 'Vesting MXI',
    mxiTournamentsText: 'Tournament MXI',
    networkTRC20: 'Withdrawals will be processed in USDT via TRC20 network (Tron)',
    walletAddressTRC20: 'USDT Wallet Address (TRC20)',
    enterTRC20WalletAddress: 'Enter your USDT TRC20 wallet address (Tron)',
    activeReferrals7Required: '7 Active Referrals required ({{count}}/7)',
    activeReferralsGeneral5: '5 Active Referrals for general withdrawals ({{count}}/5)',
    activeReferralsVesting7: '7 Active Referrals for vesting withdrawals ({{count}}/7)',
    vestingGenerates3Percent: 'Vesting generates 3% monthly only on directly purchased MXI',
    verifyWalletAddressCarefully: 'Verify that your wallet address is correct and compatible with TRC20 network (Tron)',
    
    // ... (rest of translations remain the same)
  },
  es: {
    // ... (keeping all existing translations, only updating the withdrawal-related ones)
    
    // Withdrawals (Retiros) Page - ACTUALIZADO A TRC20
    withdraw: 'Retirar',
    retiros: 'Retiros',
    loadingData: 'Cargando datos...',
    mxiAvailable: 'MXI Disponible',
    totalMXI: 'MXI Total',
    approximateUSDT: 'USDT Aproximado',
    withdrawalType: 'Tipo de Retiro',
    withdrawMXIPurchased: 'Retirar MXI Comprado',
    mxiAcquiredThroughPurchases: 'MXI adquirido mediante compras',
    lockedUntilLaunch: 'Bloqueado hasta el lanzamiento',
    withdrawMXICommissions: 'Retirar MXI de Comisiones',
    mxiFromReferralCommissions: 'MXI de comisiones por referidos',
    available: 'Disponible',
    availableLabel: 'Disponible',
    withdrawMXIVesting: 'Retirar MXI de Vesting',
    mxiGeneratedByYield: 'MXI generado por rendimiento',
    realTime: 'Tiempo real',
    activeReferralsForVestingWithdrawals: '7 Referidos Activos para retiros de vesting ({{count}}/7)',
    withdrawMXITournaments: 'Retirar MXI de Torneos',
    mxiWonInTournamentsAndChallenges: 'MXI ganado en torneos y desafíos',
    withdrawalDetails: 'Detalles del Retiro',
    withdrawalsInUSDT: 'Los retiros se procesan en USDT',
    withdrawalsInUSDTTRC20: 'Retiros en USDT (Red TRC20 - Tron)',
    amountMXI: 'Cantidad (MXI)',
    amountInMXI: 'Cantidad en MXI',
    maximum: 'Máx',
    equivalentInUSDT: 'Equivalente en USDT',
    rate: 'Tasa',
    walletAddressTRC20: 'Dirección de Billetera (TRC20)',
    enterYourTRC20WalletAddress: 'Ingresa tu dirección de billetera TRC20 (Tron)',
    requestWithdrawal: 'Solicitar Retiro',
    withdrawalRequirements: 'Requisitos de Retiro',
    activeReferralsForGeneralWithdrawals2: '5 Referidos Activos para retiros generales ({{count}}/5)',
    mxiLaunchRequiredForPurchasedAndVesting: 'Lanzamiento de MXI requerido para retiros de Comprado y Vesting',
    importantInformation: 'Información Importante',
    withdrawalsInUSDTTRC20Info: 'Los retiros se procesan en USDT en la red TRC20 (Tron)',
    conversionInfo: 'Tasa de conversión: 1 MXI = 0.4 USDT',
    mxiCommissionsInfo: 'Las Comisiones MXI están disponibles inmediatamente con 5 referidos activos + KYC',
    mxiTournamentsInfo: 'Los Torneos MXI están disponibles con los mismos requisitos que las comisiones',
    mxiVestingInfo: 'El Vesting MXI requiere 7 referidos activos y el lanzamiento de MXI',
    mxiPurchasedInfo: 'El MXI Comprado está bloqueado hasta el lanzamiento oficial de MXI',
    mxiCommissionsAvailableImmediately: 'Las Comisiones MXI están disponibles inmediatamente con 5 referidos activos + KYC',
    mxiTournamentsAvailableSameAsCommissions: 'Los Torneos MXI están disponibles con los mismos requisitos que las comisiones',
    mxiVestingRequires7Referrals: 'El Vesting MXI requiere 7 referidos activos y el lanzamiento de MXI',
    mxiPurchasedLockedUntilLaunch: 'El MXI Comprado está bloqueado hasta el lanzamiento oficial de MXI',
    realTimeUpdateInfo: 'El saldo de vesting se actualiza en tiempo real cada segundo',
    processingTime: 'Tiempo de Procesamiento',
    processingTimeInfo: 'Los retiros se procesan en 24-48 horas',
    verifyWalletAddress: 'Verificar Dirección de Billetera',
    verifyWalletAddressInfo: 'Verifica tu dirección de billetera cuidadosamente antes de enviar',
    viewWithdrawalHistory2: 'Ver Historial de Retiros',
    invalidAmount: 'Cantidad Inválida',
    enterValidAmount: 'Por favor ingresa una cantidad válida',
    missingInformation: 'Información Faltante',
    enterWalletAddress: 'Por favor ingresa tu dirección de billetera',
    insufficientBalanceNeed: 'Necesitas {{needed}} MXI pero solo tienes {{available}} MXI disponibles',
    withdrawalNotAvailable: 'Retiro No Disponible',
    withdrawalsAvailableAfterLaunch: 'Los retiros de {{label}} estarán disponibles después del lanzamiento de MXI ({{days}} días restantes)',
    requirementNotMet: 'Requisito No Cumplido',
    vestingRequires7Referrals: 'Los retiros de vesting requieren 7 referidos activos. Actualmente tienes {{count}}.',
    understood: 'Entendido',
    notEligible: 'No Elegible',
    need5ActiveReferralsAndKYC: 'Necesitas 5 referidos activos y KYC aprobado para retirar comisiones y torneos',
    confirmWithdrawal: 'Confirmar Retiro',
    confirmWithdrawalMessage: '¿Estás seguro de que quieres retirar {{mxi}} MXI ({{label}})?\n\nRecibirás aproximadamente {{usdt}} USDT',
    requestSent: 'Solicitud Enviada',
    withdrawalRequestSent: '¡Solicitud de retiro enviada exitosamente!\n\n{{mxi}} MXI ({{label}}) → {{usdt}} USDT\n\nUn administrador procesará tu retiro en 24-48 horas.',
    errorProcessingWithdrawal: 'Error al procesar el retiro. Por favor intenta de nuevo.',
    mxiPurchasedText: 'MXI Comprado',
    mxiCommissionsText: 'MXI de Comisiones',
    mxiVestingText: 'MXI de Vesting',
    mxiTournamentsText: 'MXI de Torneos',
    networkTRC20: 'Los retiros se procesarán en USDT por la red TRC20 (Tron)',
    walletAddressTRC20: 'Dirección de Billetera USDT (TRC20)',
    enterTRC20WalletAddress: 'Ingresa tu dirección de billetera USDT TRC20 (Tron)',
    activeReferrals7Required: '7 Referidos Activos requeridos ({{count}}/7)',
    activeReferralsGeneral5: '5 Referidos Activos para retiros generales ({{count}}/5)',
    activeReferralsVesting7: '7 Referidos Activos para retiros de vesting ({{count}}/7)',
    vestingGenerates3Percent: 'El vesting genera un 3% mensual solo sobre MXI comprado directamente',
    verifyWalletAddressCarefully: 'Verifica que tu dirección de billetera sea correcta y compatible con la red TRC20 (Tron)',
    
    // ... (rest of translations remain the same)
  },
  pt: {
    // ... (keeping all existing translations, only updating the withdrawal-related ones)
    
    // Withdrawals (Retiros) Page - ATUALIZADO PARA TRC20
    withdraw: 'Retirar',
    retiros: 'Retiradas',
    loadingData: 'Carregando dados...',
    mxiAvailable: 'MXI Disponível',
    totalMXI: 'MXI Total',
    approximateUSDT: 'USDT Aproximado',
    withdrawalType: 'Tipo de Retirada',
    withdrawMXIPurchased: 'Retirar MXI Comprado',
    mxiAcquiredThroughPurchases: 'MXI adquirido através de compras',
    lockedUntilLaunch: 'Bloqueado até o lançamento',
    withdrawMXICommissions: 'Retirar MXI de Comissões',
    mxiFromReferralCommissions: 'MXI de comissões por referências',
    available: 'Disponível',
    availableLabel: 'Disponível',
    withdrawMXIVesting: 'Retirar MXI de Vesting',
    mxiGeneratedByYield: 'MXI gerado por rendimento',
    realTime: 'Tempo real',
    activeReferralsForVestingWithdrawals: '7 Referências Ativas para retiradas de vesting ({{count}}/7)',
    withdrawMXITournaments: 'Retirar MXI de Torneos',
    mxiWonInTournamentsAndChallenges: 'MXI ganho em torneios e desafios',
    withdrawalDetails: 'Detalhes da Retirada',
    withdrawalsInUSDT: 'As retiradas são processadas em USDT',
    withdrawalsInUSDTTRC20: 'Retiradas em USDT (Rede TRC20 - Tron)',
    amountMXI: 'Quantidade (MXI)',
    amountInMXI: 'Quantidade em MXI',
    maximum: 'Máx',
    equivalentInUSDT: 'Equivalente em USDT',
    rate: 'Taxa',
    walletAddressTRC20: 'Endereço da Carteira (TRC20)',
    enterYourTRC20WalletAddress: 'Digite seu endereço de carteira TRC20 (Tron)',
    requestWithdrawal: 'Solicitar Retirada',
    withdrawalRequirements: 'Requisitos de Retirada',
    activeReferralsForGeneralWithdrawals2: '5 Referências Ativas para retiradas gerais ({{count}}/5)',
    mxiLaunchRequiredForPurchasedAndVesting: 'Lançamento de MXI necessário para retiradas de Comprado e Vesting',
    importantInformation: 'Informação Importante',
    withdrawalsInUSDTTRC20Info: 'As retiradas são processadas em USDT na rede TRC20 (Tron)',
    conversionInfo: 'Taxa de conversão: 1 MXI = 0.4 USDT',
    mxiCommissionsInfo: 'As Comissões MXI estão disponíveis imediatamente com 5 referências ativas + KYC',
    mxiTournamentsInfo: 'Os Torneios MXI estão disponíveis com os mesmos requisitos que as comissões',
    mxiVestingInfo: 'O Vesting MXI requer 7 referências ativas e o lançamento de MXI',
    mxiPurchasedInfo: 'O MXI Comprado está bloqueado até o lançamento oficial de MXI',
    mxiCommissionsAvailableImmediately: 'As Comissões MXI estão disponíveis imediatamente com 5 referências ativas + KYC',
    mxiTournamentsAvailableSameAsCommissions: 'Os Torneios MXI estão disponíveis com os mesmos requisitos que as comissões',
    mxiVestingRequires7Referrals: 'O Vesting MXI requer 7 referências ativas e o lançamento de MXI',
    mxiPurchasedLockedUntilLaunch: 'O MXI Comprado está bloqueado até o lançamento oficial de MXI',
    realTimeUpdateInfo: 'O saldo de vesting é atualizado em tempo real a cada segundo',
    processingTime: 'Tempo de Processamento',
    processingTimeInfo: 'As retiradas são processadas em 24-48 horas',
    verifyWalletAddress: 'Verificar Endereço da Carteira',
    verifyWalletAddressInfo: 'Verifique seu endereço de carteira cuidadosamente antes de enviar',
    viewWithdrawalHistory2: 'Ver Histórico de Retiradas',
    invalidAmount: 'Quantidade Inválida',
    enterValidAmount: 'Por favor, digite uma quantidade válida',
    missingInformation: 'Informação Faltante',
    enterWalletAddress: 'Por favor, digite seu endereço de carteira',
    insufficientBalanceNeed: 'Você precisa de {{needed}} MXI mas só tem {{available}} MXI disponíveis',
    withdrawalNotAvailable: 'Retirada Não Disponível',
    withdrawalsAvailableAfterLaunch: 'As retiradas de {{label}} estarão disponíveis após o lançamento de MXI ({{days}} dias restantes)',
    requirementNotMet: 'Requisito Não Atendido',
    vestingRequires7Referrals: 'As retiradas de vesting requerem 7 referências ativas. Atualmente você tem {{count}}.',
    understood: 'Entendido',
    notEligible: 'Não Elegível',
    need5ActiveReferralsAndKYC: 'Você precisa de 5 referências ativas e KYC aprovado para retirar comissões e torneios',
    confirmWithdrawal: 'Confirmar Retirada',
    confirmWithdrawalMessage: 'Tem certeza de que deseja retirar {{mxi}} MXI ({{label}})?\n\nVocê receberá aproximadamente {{usdt}} USDT',
    requestSent: 'Solicitação Enviada',
    withdrawalRequestSent: 'Solicitação de retirada enviada com sucesso!\n\n{{mxi}} MXI ({{label}}) → {{usdt}} USDT\n\nUm administrador processará sua retirada em 24-48 horas.',
    errorProcessingWithdrawal: 'Erro ao processar a retirada. Por favor, tente novamente.',
    mxiPurchasedText: 'MXI Comprado',
    mxiCommissionsText: 'MXI de Comissões',
    mxiVestingText: 'MXI de Vesting',
    mxiTournamentsText: 'MXI de Torneios',
    networkTRC20: 'As retiradas serão processadas em USDT pela rede TRC20 (Tron)',
    walletAddressTRC20: 'Endereço da Carteira USDT (TRC20)',
    enterTRC20WalletAddress: 'Digite seu endereço de carteira USDT TRC20 (Tron)',
    activeReferrals7Required: '7 Referências Ativas necessárias ({{count}}/7)',
    activeReferralsGeneral5: '5 Referências Ativas para retiradas gerais ({{count}}/5)',
    activeReferralsVesting7: '7 Referências Ativas para retiradas de vesting ({{count}}/7)',
    vestingGenerates3Percent: 'O vesting gera 3% mensal apenas sobre MXI comprado diretamente',
    verifyWalletAddressCarefully: 'Verifique se seu endereço de carteira está correto e compatível com a rede TRC20 (Tron)',
    
    // ... (rest of translations remain the same)
  },
};

// Create i18n instance
const i18n = new I18n(translations);

// Set default locale
i18n.defaultLocale = 'es';
i18n.enableFallback = true;

// Storage key for language preference
const LANGUAGE_KEY = '@mxi_language';

// Initialize language from storage or device locale
export const initializeLanguage = async () => {
  try {
    const savedLanguage = await AsyncStorage.getItem(LANGUAGE_KEY);
    
    if (savedLanguage) {
      i18n.locale = savedLanguage;
    } else {
      // Get device locale
      const deviceLocale = Localization.getLocales()[0]?.languageCode || 'es';
      
      // Map device locale to supported languages
      if (deviceLocale.startsWith('en')) {
        i18n.locale = 'en';
      } else if (deviceLocale.startsWith('pt')) {
        i18n.locale = 'pt';
      } else {
        i18n.locale = 'es'; // Default to Spanish
      }
    }
  } catch (error) {
    console.error('Error initializing language:', error);
    i18n.locale = 'es';
  }
};

// Save language preference
export const setLanguage = async (language: 'en' | 'es' | 'pt') => {
  try {
    await AsyncStorage.setItem(LANGUAGE_KEY, language);
    i18n.locale = language;
  } catch (error) {
    console.error('Error saving language:', error);
  }
};

// Get current language
export const getCurrentLanguage = (): 'en' | 'es' | 'pt' => {
  return i18n.locale as 'en' | 'es' | 'pt';
};

export { i18n };
